import { PredictionData, WhatIfData } from '../types.ts';

const generateForecast = (start: number, end: number, points: number, volatility: number, hasHistory: boolean) => {
    const data = [];
    const historyPoints = hasHistory ? Math.floor(points / 3) : 0;
    const forecastPoints = points - historyPoints;

    // Generate historical data
    for (let i = 0; i < historyPoints; i++) {
        const progress = i / (points - 1);
        const linearValue = start + (end - start) * progress;
        const noise = (Math.random() - 0.5) * (start * (volatility / 2));
        const actual = Math.round(linearValue + noise);
        data.push({
            name: `${historyPoints - i} روز قبل`,
            actual: actual,
            low: actual,
            mid: actual,
            high: actual
        });
    }

    // Generate forecast data
    for (let i = 0; i < forecastPoints; i++) {
        const progress = (i + historyPoints) / (points - 1);
        const mid = Math.round(start + (end - start) * progress + (Math.random() - 0.5) * (start * volatility * progress));
        const bandSize = mid * volatility * (1 + progress) * 0.7;
        data.push({
            name: i === 0 ? 'امروز' : `${i} روز بعد`,
            low: Math.round(mid - bandSize),
            mid: mid,
            high: Math.round(mid + bandSize),
        });
    }
    return data;
};


export const predictionData: PredictionData = {
    'hot-rolled': {
        '7': {
            accuracy: 94,
            forecast: generateForecast(42100, 42800, 11, 0.02, true),
            factors: [
                { name: 'نرخ دلار', impact: 'افزایش ۰.۸٪ هفتگی', direction: 'up', description: 'نرخ ارز مستقیماً هزینه تمام‌شده مواد اولیه وارداتی مانند الکترود گرافیتی را افزایش می‌دهد و محرک اصلی قیمت داخلی است.' },
                { name: 'موجودی انبارها', impact: 'کاهش ۵٪', direction: 'up', description: 'کاهش موجودی در انبارها به معنای کمبود عرضه نسبت به تقاضا است که فشار صعودی بر قیمت‌ها وارد می‌کند.' },
                { name: 'قیمت جهانی HRC', impact: 'ثبات نسبی', direction: 'down', description: 'عدم رشد قیمت در بازارهای جهانی، پتانسیل افزایش قیمت داخلی را محدود کرده و به عنوان یک عامل بازدارنده عمل می‌کند.' }
            ],
            scenarios: [
                { condition: 'اگر نرخ دلار به ۶۳,۰۰۰ تومان برسد', outcome: 'تغییر قیمت: +۲.۵٪', description: 'این سناریو اثر جهش ارزی بر هزینه‌های تولید را شبیه‌سازی می‌کند که می‌تواند منجر به یک رالی صعودی در بازار شود.' },
                { condition: 'اگر محدودیت عرضه تشدید شود', outcome: 'تغییر قیمت: +۱.۸٪', description: 'در صورت کاهش عرضه توسط تولیدکنندگان بزرگ (به دلیل تعمیرات یا سیاست‌های بازار)، قیمت‌ها به سرعت واکنش مثبت نشان خواهند داد.' }
            ]
        },
        '30': {
            accuracy: 88,
            forecast: generateForecast(42100, 43500, 10, 0.04, false).map((p, i) => ({...p, name: `${i*3} روز بعد`})),
            factors: [
                { name: 'تقاضای فصلی ساخت‌وساز', impact: 'افزایش پیش‌بینی شده', direction: 'up', description: 'با شروع فصل گرما و فعال شدن پروژه‌های عمرانی، تقاضا برای محصولات فولادی به طور سنتی افزایش می‌یابد.' },
                { name: 'سیاست‌های ارزی بانک مرکزی', impact: 'عدم قطعیت بالا', direction: 'up', description: 'سیاست‌های انقباضی یا انبساطی بانک مرکزی در کنترل نقدینگی و نرخ ارز، می‌تواند مسیر بازار را به کلی تغییر دهد.' },
                { name: 'قیمت سنگ آهن', impact: 'روند صعودی ملایم', direction: 'up', description: 'سنگ آهن به عنوان ماده اولیه اصلی، هرگونه افزایش قیمت آن در بازارهای جهانی مستقیماً هزینه تولید را بالا می‌برد.' }
            ],
            scenarios: [
                { condition: 'اگر پروژه‌های عمرانی بزرگ فعال شوند', outcome: 'تغییر قیمت: +۵٪', description: 'تزریق بودجه به پروژه‌های ملی می‌تواند یک شوک تقاضای مثبت در بازار ایجاد کرده و قیمت‌ها را به شدت افزایش دهد.' },
                { condition: 'اگر سیاست انقباضی بانک مرکزی تشدید شود', outcome: 'تغییر قیمت: -۲٪', description: 'در صورت کنترل شدید نقدینگی و ثبات نرخ ارز، از فشار تورمی کاسته شده و قیمت‌ها ممکن است اصلاح شوند.' }
            ]
        },
        '90': {
            accuracy: 79,
            forecast: generateForecast(42100, 45000, 10, 0.08, false).map((p, i) => ({...p, name: `${i*9} روز بعد`})),
            factors: [
                { name: 'چشم‌انداز اقتصاد کلان', impact: 'انتظار تورم ۴۰ درصدی', direction: 'up', description: 'در شرایط تورمی، قیمت کالاها از جمله فولاد به عنوان ابزاری برای حفظ ارزش پول، گرایش به رشد دارند.' },
                { name: 'روند تولید فولاد چین', impact: 'کاهش تولید زمستانی', direction: 'up', description: 'کاهش تولید در چین به دلیل مسائل زیست‌محیطی، عرضه جهانی را کاهش داده و از قیمت‌ها در سطح بین‌المللی حمایت می‌کند.' },
                { name: 'مذاکرات سیاسی بین‌المللی', impact: 'ریسک بالا', direction: 'down', description: 'هرگونه گشایش در روابط بین‌المللی می‌تواند منجر به کاهش نرخ ارز و ثبات اقتصادی شود که بر قیمت‌ها اثر کاهشی دارد.' }
            ],
            scenarios: [
                { condition: 'در صورت توافق سیاسی', outcome: 'تغییر قیمت: -۸٪', description: 'یک توافق سیاسی می‌تواند انتظارات تورمی را به شدت کاهش دهد و با کاهش نرخ ارز، منجر به اصلاح قابل توجه قیمت‌ها شود.' },
                { condition: 'در صورت رکود اقتصادی عمیق', outcome: 'تغییر قیمت: -۵٪', description: 'کاهش رشد اقتصادی به معنای کاهش تقاضای کل در جامعه است که می‌تواند منجر به کاهش ساخت‌وساز و افت قیمت فولاد گردد.' }
            ]
        }
    },
    'cold-rolled': {
        '7': {
            accuracy: 92,
            forecast: generateForecast(48200, 48900, 11, 0.025, true),
            factors: [
                { name: 'تقاضای صنعت خودرو', impact: 'افزایش تولید', direction: 'up', description: 'رشد تولید خودروسازان به معنای افزایش مستقیم تقاضا برای ورق سرد به عنوان ماده اولیه اصلی بدنه خودرو است.' },
                { name: 'قیمت ورق گرم', impact: 'روند صعودی', direction: 'up', description: 'ورق سرد از ورق گرم تولید می‌شود، بنابراین قیمت آن همواره تابعی از قیمت ماده اولیه خود یعنی ورق گرم است.' },
                { name: 'موجودی تولیدکنندگان', impact: 'در سطح پایین', direction: 'up', description: 'پایین بودن موجودی انبارها باعث می‌شود هر افزایش تقاضایی به سرعت به افزایش قیمت منجر شود.' }
            ],
            scenarios: [
                { condition: 'اگر تعرفه واردات خودرو کاهش یابد', outcome: 'تغییر قیمت: -۳٪', description: 'کاهش تعرفه واردات خودرو می‌تواند به کاهش تولید داخلی و در نتیجه افت تقاضا برای ورق سرد منجر شود.' }
            ]
        },
        '30': {
            accuracy: 85,
            forecast: generateForecast(48200, 49500, 10, 0.05, false).map((p, i) => ({...p, name: `${i*3} روز بعد`})),
            factors: [
                { name: 'تقاضای لوازم خانگی', impact: 'رشد فصلی', direction: 'up', description: 'در برخی فصول مانند نزدیک به اعیاد، تقاضا برای لوازم خانگی افزایش یافته و تولیدکنندگان خرید ورق سرد را افزایش می‌دهند.' },
                { name: 'قیمت جهانی فولاد', impact: 'صعودی', direction: 'up', description: 'افزایش قیمت در بازارهای جهانی، قیمت‌های داخلی را نیز برای حفظ قابلیت صادرات، حمایت می‌کند.' },
                { name: 'هزینه انرژی', impact: 'احتمال افزایش', direction: 'up', description: 'هرگونه افزایش در قیمت برق، هزینه تولید را در کارخانجات نورد سرد به شکل قابل توجهی بالا می‌برد.' }
            ],
            scenarios: [
                { condition: 'اگر وام خرید کالای ایرانی فعال شود', outcome: 'تغییر قیمت: +۴٪', description: 'این سیاست می‌تواند تقاضا در بخش لوازم خانگی را به شدت تحریک کرده و قیمت ورق سرد را افزایش دهد.' }
            ]
        },
        '90': {
            accuracy: 78,
            forecast: generateForecast(48200, 51000, 10, 0.09, false).map((p, i) => ({...p, name: `${i*9} روز بعد`})),
            factors: [
                { name: 'چشم‌انداز تورم عمومی', impact: 'بالا', direction: 'up', description: 'ورق سرد نیز مانند سایر کالاها، در شرایط تورمی تمایل به افزایش قیمت برای حفظ ارزش دارد.' },
                { name: 'سیاست‌های واردات', impact: 'محدودیت‌ها', direction: 'up', description: 'محدودیت بر واردات محصولات نهایی (خودرو و لوازم خانگی) از تولید داخلی و در نتیجه تقاضا برای ورق سرد حمایت می‌کند.' },
                { name: 'رقابت‌پذیری صادراتی', impact: 'بستگی به نرخ ارز دارد', direction: 'up', description: 'افزایش نرخ ارز می‌تواند صادرات را جذاب‌تر کرده و بخشی از تولید را به سمت بازارهای خارجی سوق دهد که باعث کاهش عرضه داخلی می‌شود.' }
            ],
            scenarios: [
                { condition: 'در صورت آزادسازی واردات خودرو', outcome: 'تغییر قیمت: -۱۰٪', description: 'این سیاست می‌تواند بزرگترین ضربه را به تقاضای ورق سرد وارد کرده و منجر به رکود و کاهش شدید قیمت شود.' }
            ]
        }
    },
     'galvanized': {
        '7': {
            accuracy: 91,
            forecast: generateForecast(53100, 53700, 11, 0.02, true),
            factors: [
                { name: 'قیمت جهانی روی (Zinc)', impact: 'افزایش ۳٪ هفتگی', direction: 'up', description: 'هزینه پوشش گالوانیزه مستقیماً به قیمت شمش روی وابسته است و افزایش آن، قیمت نهایی را بالا می‌برد.' },
                { name: 'تقاضای صنایع ساختمانی', impact: 'پایدار', direction: 'up', description: 'استفاده در سقف‌ها، کانال‌ها و سازه‌های سبک، یک تقاضای پایدار برای این محصول ایجاد کرده است.' },
                { name: 'نرخ ارز', impact: 'صعودی', direction: 'up', description: 'بخشی از مواد اولیه و همچنین قیمت‌گذاری صادراتی تحت تأثیر مستقیم نرخ ارز قرار دارد.' }
            ],
            scenarios: [
                { condition: 'اگر قیمت جهانی روی ۵٪ دیگر رشد کند', outcome: 'تغییر قیمت: +۲.۲٪', description: 'با توجه به سهم هزینه پوشش در قیمت تمام شده، هر نوسان قیمت روی به سرعت به بازار ورق گالوانیزه منتقل می‌شود.' }
            ]
        },
        '30': {
            accuracy: 86,
            forecast: generateForecast(53100, 54500, 10, 0.04, false).map((p, i) => ({...p, name: `${i*3} روز بعد`})),
            factors: [
                { name: 'تقاضای بخش کشاورزی', impact: 'افزایش فصلی', direction: 'up', description: 'در فصول خاصی، تقاضا برای ساخت گلخانه‌ها و تجهیزات کشاورزی که از ورق گالوانیزه استفاده می‌کنند، افزایش می‌یابد.' },
                { name: 'قیمت ورق سرد', impact: 'روند صعودی', direction: 'up', description: 'ورق گالوانیزه بر پایه ورق سرد تولید می‌شود و قیمت آن همبستگی بالایی با این محصول دارد.' },
                { name: 'صادرات به کشورهای همسایه', impact: 'رو به رشد', direction: 'up', description: 'تقاضای خوب از سوی کشورهای همسایه، بخشی از تولید را جذب کرده و از کاهش قیمت در بازار داخلی جلوگیری می‌کند.' }
            ],
            scenarios: [
                { condition: 'اگر تعرفه صادراتی افزایش یابد', outcome: 'تغییر قیمت: -۳.۵٪', description: 'این سیاست با کاهش جذابیت صادرات، عرضه در بازار داخلی را افزایش داده و منجر به فشار بر قیمت‌ها می‌شود.' }
            ]
        },
        '90': {
            accuracy: 80,
            forecast: generateForecast(53100, 56000, 10, 0.08, false).map((p, i) => ({...p, name: `${i*9} روز بعد`})),
            factors: [
                 { name: 'سیاست‌های عمرانی دولت', impact: 'انبساطی', direction: 'up', description: 'پروژه‌های عمرانی بزرگ مانند ساخت مدارس و بیمارستان‌ها، تقاضای قابل توجهی برای این محصول ایجاد می‌کند.' },
                 { name: 'چشم‌انداز تورم', impact: 'بالا', direction: 'up', description: 'مانند سایر محصولات فولادی، قیمت ورق گالوانیزه نیز در بلندمدت تابعی از نرخ تورم عمومی اقتصاد است.' },
                 { name: 'رقابت با محصولات وارداتی', impact: 'محدود', direction: 'up', description: 'تعرفه‌های وارداتی و نرخ ارز بالا، رقابت را برای محصولات وارداتی دشوار کرده و از تولید داخل حمایت می‌کند.' }
            ],
            scenarios: [
                { condition: 'در صورت رکود بخش مسکن', outcome: 'تغییر قیمت: -۶٪', description: 'رکود عمیق در ساخت‌وساز می‌تواند تقاضای اصلی این محصول را کاهش داده و منجر به اصلاح قیمت شود.' }
            ]
        }
    },
    'slab': {
        '7': {
            accuracy: 95,
            forecast: generateForecast(35200, 35800, 11, 0.02, true),
            factors: [
                { name: 'تقاضای کارخانجات نورد', impact: 'در سطح بالا', direction: 'up', description: 'اسلب ماده اولیه اصلی برای تولید ورق گرم است و تقاضای آن مستقیماً به برنامه تولید کارخانجات نورد بستگی دارد.' },
                { name: 'قیمت سنگ آهن', impact: 'افزایش ۲٪', direction: 'up', description: 'به عنوان محصول میانی، قیمت اسلب همبستگی بسیار بالایی با هزینه ماده اولیه اصلی خود یعنی سنگ آهن دارد.' },
                { name: 'قیمت جهانی اسلب', impact: 'صعودی', direction: 'up', description: 'قیمت در بازارهای جهانی به عنوان یک شاخص و کف قیمتی برای معاملات داخلی عمل می‌کند.' }
            ],
            scenarios: [
                { condition: 'اگر قطعی برق کارخانجات نورد را متوقف کند', outcome: 'تغییر قیمت: -۲٪', description: 'توقف تولید در کارخانجات پایین‌دستی به معنای کاهش ناگهانی تقاضا برای اسلب و فشار بر قیمت آن است.' }
            ]
        },
        '30': {
            accuracy: 89,
            forecast: generateForecast(35200, 36500, 10, 0.04, false).map((p, i) => ({...p, name: `${i*3} روز بعد`})),
            factors: [
                { name: 'هزینه انرژی (گاز و برق)', impact: 'روند صعودی', direction: 'up', description: 'تولید اسلب فرآیندی بسیار انرژی‌بر است و هرگونه افزایش در تعرفه انرژی، هزینه تمام شده را به شدت بالا می‌برد.' },
                { name: 'تقاضای صادراتی', impact: 'قوی', direction: 'up', description: 'تقاضای خوب از بازارهای منطقه برای اسلب ایران، بخشی از تولید را جذب کرده و از قیمت داخلی حمایت می‌کند.' },
                { name: 'نرخ ارز', impact: 'افزایش پیش‌بینی شده', direction: 'up', description: 'نرخ ارز هم بر هزینه واردات برخی مواد و هم بر درآمد صادراتی تأثیر مستقیم دارد.' }
            ],
            scenarios: [
                { condition: 'اگر محدودیت‌های صادراتی وضع شود', outcome: 'تغییر قیمت: -۵٪', description: 'این سیاست با هدایت تمام تولید به سمت بازار داخل، باعث مازاد عرضه و افت قیمت خواهد شد.' }
            ]
        },
        '90': {
            accuracy: 81,
            forecast: generateForecast(35200, 38000, 10, 0.08, false).map((p, i) => ({...p, name: `${i*9} روز بعد`})),
            factors: [
                 { name: 'برنامه‌های توسعه فولادسازان', impact: 'افزایش ظرفیت', direction: 'down', description: 'در بلندمدت، افزایش ظرفیت تولید اسلب در کشور می‌تواند به تعادل بهتر بازار و کنترل قیمت کمک کند.' },
                 { name: 'چشم‌انداز اقتصاد جهانی', impact: 'عدم قطعیت', direction: 'down', description: 'هرگونه رکود در اقتصاد جهانی می‌تواند تقاضای بین‌المللی برای فولاد و در نتیجه اسلب را کاهش دهد.' },
                 { name: 'سیاست‌های زیست‌محیطی چین', impact: 'کاهش تولید', direction: 'up', description: 'محدودیت‌های تولید در چین برای کنترل آلودگی، عرضه جهانی را کاهش داده و از قیمت‌ها حمایت می‌کند.' }
            ],
            scenarios: [
                { condition: 'در صورت رکود جهانی', outcome: 'تغییر قیمت: -۱۰٪', description: 'یک رکود اقتصادی جهانی می‌تواند تقاضای صادراتی را به شدت کاهش داده و باعث مازاد عرضه در بازار داخلی شود.' }
            ]
        }
    },
    'rebars': {
        '7': {
            accuracy: 96,
            forecast: generateForecast(25150, 25500, 11, 0.015, true),
            factors: [
                { name: 'تقاضای پروژه‌های کوچک', impact: 'افزایش ۱۰٪', direction: 'up', description: 'با شروع فصل کاری، پروژه‌های ساختمانی کوچک مقیاس فعال شده و تقاضای مقطعی برای میلگرد را افزایش می‌دهند.' },
                { name: 'قیمت قراضه', impact: 'ثبات در سقف قیمت', direction: 'up', description: 'قراضه ماده اولیه اصلی تولید میلگرد به روش قوس الکتریکی است و قیمت بالای آن، کف قیمتی میلگرد را تعیین می‌کند.' },
                { name: 'عرضه در بورس کالا', impact: 'افزایش جزئی', direction: 'down', description: 'افزایش عرضه توسط تولیدکنندگان در بورس کالا می‌تواند به کنترل نوسانات و جلوگیری از رشد هیجانی قیمت کمک کند.' }
            ],
            scenarios: [
                { condition: 'اگر بارندگی‌ها کاهش یابد', outcome: 'افزایش تقاضا و قیمت: +۱.۵٪', description: 'آب و هوای مساعد به معنای سرعت گرفتن پروژه‌های ساختمانی و افزایش تقاضا برای میلگرد است.' }
            ]
        },
        '30': {
            accuracy: 91,
            forecast: generateForecast(25150, 26000, 10, 0.03, false).map((p, i) => ({...p, name: `${i*3} روز بعد`})),
            factors: [
                 { name: 'شروع پروژه‌های عمرانی', impact: 'رشد تقاضا', direction: 'up', description: 'تخصیص بودجه‌های عمرانی و فعال شدن پروژه‌های دولتی، یک محرک تقاضای بسیار قوی برای میلگرد محسوب می‌شود.' },
                 { name: 'نرخ دلار', impact: 'روند صعودی', direction: 'up', description: 'نرخ ارز به عنوان یک شاخص انتظارات تورمی عمل کرده و بر قیمت تمام کالاها از جمله میلگرد تأثیر روانی و واقعی دارد.' },
                 { name: 'هزینه حمل و نقل', impact: 'افزایش فصلی', direction: 'up', description: 'هزینه لجستیک بخش مهمی از قیمت تمام شده برای مصرف‌کننده نهایی را تشکیل می‌دهد و افزایش آن به رشد قیمت کمک می‌کند.' }
            ],
            scenarios: [
                { condition: 'با تخصیص بودجه عمرانی دولت', outcome: 'جهش قیمت به بالای ۲۷,۰۰۰ تومان', description: 'این اقدام می‌تواند به سرعت تقاضا را افزایش داده و در صورت عدم افزایش متناسب عرضه، باعث جهش قیمت شود.' }
            ]
        },
        '90': {
            accuracy: 82,
            forecast: generateForecast(25150, 27500, 10, 0.07, false).map((p, i) => ({...p, name: `${i*9} روز بعد`})),
            factors: [
                { name: 'چشم انداز تورم', impact: 'بالا', direction: 'up', description: 'در یک اقتصاد تورمی، قیمت میلگرد به عنوان یک کالای سرمایه‌ای، همگام با نرخ تورم رشد خواهد کرد.' },
                { name: 'سیاست های مسکن', impact: 'انبساطی', direction: 'up', description: 'سیاست‌هایی مانند وام مسکن یا طرح‌های ملی مسکن، تقاضای بلندمدت برای مصالح ساختمانی از جمله میلگرد را تضمین می‌کند.' },
                { name: 'قیمت انرژی', impact: 'افزایش احتمالی', direction: 'up', description: 'تولید فولاد بسیار انرژی‌بر است و افزایش قیمت گاز و برق مستقیماً هزینه تولید را افزایش می‌دهد.' }
            ],
            scenarios: [
                 { condition: 'در صورت رکود در بخش ساخت و ساز', outcome: 'تثبیت قیمت در کانال ۲۶,۰۰۰ تومان', description: 'رکود در بخش پیشران مسکن می‌تواند تقاضای میلگرد را به شدت کاهش داده و مانع از رشد بیشتر قیمت شود.' }
            ]
        }
    }
};


export const whatIfInitialData: WhatIfData = {
    'dollar': { id: 'dollar', name: 'نرخ دلار', value: 61850, min: 55000, max: 70000, step: 50, unit: 'تومان' },
    'oil': { id: 'oil', name: 'نفت خام برنت', value: 85, min: 70, max: 110, step: 0.5, unit: 'دلار' },
    'ironOre': { id: 'ironOre', name: 'سنگ آهن', value: 122, min: 100, max: 150, step: 1, unit: 'دلار' },
    'cokingCoal': { id: 'cokingCoal', name: 'زغال سنگ کک شو', value: 253, min: 200, max: 350, step: 1, unit: 'دلار'}
};